# UC-L1. Работать со списком покупок мероприятия.

*Автор*: Березовская Юлия
*Дата создания*: 29.11.2025

[Схема]()

---

## 1. Основное действующее лицо
Участник мероприятия

---

## 2. Дополнительные действующие лица
Организатор

---

## 3. Описание
Пользователь может просматривать список покупок, отмечать купленные позиции и раскрывать состав агрегированных пунктов. 
Организатор дополнительно может добавлять, удалять и пересоздавать позиции списка покупок.

---

## 4. Условие-триггер
0. Пользователь открывает раздел "Список покупок".

---

## 5. Предварительные условия
PRE-1. Участник мероприятия получил доступ к мероприятию.
PRE-2. Список покупок уже сформирован системой (BR-L1.1–L1.3).
PRE-3. Пользователь имеет доступ к мероприятию (через ссылку или напрямую).

---

## 6. Выходные условия
POST-1. Список покупок отражает все изменения, сделанные участниками и организатором.
POST-2. Статусы купленных/некупленных позиций синхронизированы между всеми пользователями (BR-L1.8).
POST-3. Информация об агрегированных пунктах корректно отображается (BR-L1.7).

---

## 7. Нормальное направление (основной поток)
1. Система отображает список продуктов.
2. Участник просматривает список.
3. Участник меняет состояние пункта списка с некупленного на купленный или наоборот.
4. Система обновляет это состояние в своей базе и для других пользователей.
5. Участник раскрывает пункт списка покупок.
6. Система отображает из ингредиентов каких рецептов состоит данный пункт (BR-L1.7.).

---

## 8. Альтернативные направления
### A1. Добавление новой позиции (только для роли Организатор)
1. Организатор выбирает действие «Добавить продукт».
2. Система отображает форму добавления ингредиента.
3. Организатор вводит название, количество, единицу измерения и заметку (см. BR-L3).
4. Система валидирует данные (BR-L3).
5. Система добавляет позицию в список, агрегируя её при необходимости (BR-L1.2, BR-L1.3).
6. Новая позиция отображается всем пользователям.

### A1-Cancel. Отмена добавления новой позиции (только для роли Организатор)
1. Организатор выбирает действие "Отменить добавление новой позиции" в альтернативном потоке А1.
2. Система остаётся в неизменном состоянии.

### A2. Удаление позиции (только для роли Организатор)
1. Организатор выбирает действие "Удалить продукт" в основном потоке.
2. Система запрашивает подтверждение на удаление продукта.
3. Организатор подтверждает удаление позиции из списка.
4. Система удаляет позицию из списка покупок мероприятия для всех пользователей.

### A2-Cancel. Отмена удаления позиции (только для роли Организатор)
1. Организатор выбирает действие "Отменить удаление продукта" на шаге 2 альтернативного потока А-2.
2. Система остаётся в неизменном состоянии.

### A3. Пересоздание списка продуктов (только для роли Организатор)
1. Организатор выбирает действие "Пересоздать список покупок на основе рецептов" в основном потоке.
4. Система полностью пересоздаёт список покупок на основе рецептов, удаляя существующие позиции и их статусы (см. BR-L1.6).
3. Организатор подтверждает пересоздание.
4. Система пересоздаёт список продутов.

### A3-Cancel. Отмена пересоздания списка продуктов (только для роли Организатор)
1. Организатор выбирает действие "Отменить пересоздание" на шаге 2 альтернативного потока А-3.
2. Система остаётся в неизменном состоянии.

---

## 9. Исключения

### E1. Ошибка загрузки списка покупок
1. На шаге 1 основного потока на сервере происходит ошибка и системе не удаётся загрузить список продуктов.
2. Система уведомляет пользователя о невозможности загрузить список покупок и предлагает повторить загрузку позже.

### E2. Ошибка валидации ингредиентов
1. На шаге 3 альтернативного потока A1 происходит ошибка валидации полей ингредиентовю.
2. Система предупреждает пользователя об ошибке.
3. Система возвращает пользователя к шагу 3 потока A1.

### E3. Ошибка сохранения новой позиции
1. На шаге 4 альтернативного потока A1 происходит ошибка.
2. Система предупреждает пользователя об ошибке.
3. Система возвращает пользователя к шагу 3 альтернативного потока A1 («ввод данных ингредиента»).

### E4. Ошибка удаления позиции
1. На шаге 4 альтернативного потока A2 происходит ошибка.
2. Система предупреждает пользователя об ошибке.
3. Система остаётся на списке покупок, позиция не удалена.

### E5. Ошибка пересоздания списка покупок
1. На шаге 4 альтернативного потока A3 происходит ошибка.
2. Система предупреждает пользователя об ошибке.
3. Система возвращает пользователя к шагу 1 основного потока.

---

## 10. Приоритет
**Высокий**

---

## 11. Бизнес-правила
- BR-L1
- BR-L2
- BR-L3
---

## 12. Другая информация

- Связанные US:
- US-L1
- US-L2
- US-L3
- US-L4
- US-L5

---

## 13. Предположения
- P1. Позиции списка покупок всегда агрегируются системой автоматически (объединение ингредиентов одинакового типа) согласно BR-L1.
- P2. Все пользователи, имеющие доступ к мероприятию, видят один и тот же список в реальном времени.
- P3. Участники не могут добавлять, удалять позиции или пересоздавать список — эти действия выполняет только Организатор (BR-L1.9).
- P4. В MVP не предусмотрено частичное редактирование позиции списка (например, изменения количества) пользователем.
- P5. Список покупок автоматически сортируется и агрегируется системой (BR-L1).
- P6. Добавленные вручную позиции не агрегируются автоматически с системными, если пользователь вводит сильно отличающиеся названия.
