# UC-E2. Редактировать мероприятие

*Автор*: Березовская Юлия
*Дата создания*: 27.11.2025

[Схема](diagrams/Мероприятие.drawio.png)

---

## 1. Основное действующее лицо
Организатор

---

## 2. Дополнительные действующие лица
Отсутствуют

---

## 3. Описание
Организатор редактирует мероприятие: управляет рецептами, при необходимости меняет дату и название мероприятия.

---

## 4. Условие-триггер
Организатор открывает мероприятие и инициирует редактирование.

---

## 5. Предварительные условия
PRE-1. Редактируемое мероприятие существует.
PRE-2. Мероприятие не находится в архиве (см. BR-E2.2).
PRE-3. Пользователь является Организатором (user_id совпадает с owner_id мероприятия/рецепта).

---

## 6. Выходные условия
POST-1. Изменения в рецептах, метаданных и порциях сохранены.
POST-2. Список покупок актуализирован согласно бизнес-правилам.

---

## 7. Нормальное направление (основной поток)
1. Система отображает текущую информацию по мероприятию (см. BR-E1).
2. Организатор изменяет список рецептов мероприятия (добавляет и/или удаляет рецепты).
3. Система сохраняет изменения состава рецептов.
4. Система обновляет список покупок мероприятия в соответствии с бизнес-правилами BR-L1 (добавляет/удаляет продукты, связанные с изменёнными рецептами, не пересчитывая список целиком). 
5. Организатор завершает редактирование.

---

## 8. Альтернативные направления
### A1. Изменение метаданных мероприятия
1. Организатор инициирует изменение метаданных мероприятия (дата, название).
2. Система отображает экран изменения метаданных мероприятия.
3. Организатор вводит данные. 
4. Организатор инициирует сохранение изменений метаданных.
5. Система сохраняет метаданные и возвращается к пункту 1 основного потока.

## A2. Изменение количества порций рецепта
1. Организатор изменяет количество порций для выбранного рецепта.
2. Система пересчитывает количество ингредиентов согласно BR-L2.
3. Система обновляет список покупок инкрементально согласно BR-L1.

### A3. Изменение списка покупок
1. Организатор в основном потоке может инициировать редактирование списка продуктов и перейти к UC-L1. 

### A4. Полное пересоздание списка покупок  
1. Организатор выбирает действие «Пересоздать список покупок».
2. Система перенаправляет к сценарию UC-L1 (альтернативный поток A5).

---

## 9. Исключения

### E1. Ошибка добавления рецепта
1. На шаге 3 возникает техническая ошибка сохранения данных.
2. Система применяет общие правила обработки ошибок (см. BR-S1–S2).
3. Пользователь остаётся на текущем экране, изменения не применяются.

### E2. Ошибка сохранения данных мероприятия
1. Организатор меняет название и/или дату мероприятия, на те, которые уже существуют в системе.
2. Организатор инициирует сохранение.
3. Система оповещает пользователя об ошибке.
4. Система остаётся на экране редактирования метаданных (см. A1) и просит исправить данные.


---

## 10. Приоритет
**Высокий**

---

## 11. Бизнес-правила
- [BR-E1](../business-rules.md#br-e1-содержание-мероприятия-br-eventscontent)
- [BR-L1](../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)
- [BR-L2](../business-rules.md#br-l2-масштабирование-порций-рецептов-в-мероприятии-br-shoppinglistscaling)
- [BR-S1, BR–S2](../business-rules.md#br-s-общие-правила-обработки-ошибок)

---

## 12. Другая информация

- Связанные US: 
[US-E3](../user-stories.md#us-e3-как-организатор-я-хочу-иметь-возможность-редактировать-мероприятие-чтобы-изменить-информацию-о-нём-иили-управлять-рецептами), 
[US-E4](../user-stories.md#us-e4-как-организатор-я-хочу-чтобы-при-добавлении-рецепта-в-меню-ингредиенты-автоматически-добавлялись-в-список-покупок-и-удалялись-соответственно-чтобы-не-пришлось-тратить-время-на-ручное-оформление-списка-и-уменьшилось-количество-потенциальных-ошибок), 
[US-E5](../user-stories.md#us-e5-как-организатор-я-хочу-иметь-возможность-пересоздать-список-покупок-с-нуля-чтобы-полностью-удалить-внесённые-вручную-правки-для-убирания-путанницы-и-возможных-ошибок), 
[US-E6](../user-stories.md#us-e6-как-организатор-я-хочу-указать-коэффициент-порций-чтобы-использовать-рецепт-для-большего-или-меньшего-количества-гостей).

- В будущем тут будут назначаться участники мероприятия

---

## 13. Предположения
- P1. Система сохраняет изменения в при добавлении рецепта в мероприятие.
