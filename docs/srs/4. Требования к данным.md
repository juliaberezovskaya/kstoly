# 4. Требования к данным
4.1. Логическая модель данных
4.1.1. Назначение модели
Содержание подпункта: 2–4 предложения, зачем в SRS нужна модель данных (зафиксировать состав данных, связи, ограничения, общий контракт для разработки/тестирования; не является физическим проектом БД).

4.1.2. Перечень сущностей
Содержание подпункта: список основных сущностей MVP (например: Организатор, Рецепт, Ингредиент рецепта, Мероприятие, Рецепт в мероприятии, Пункт списка покупок, Справочник ингредиентов, Ссылка-приглашение). По каждой — 1 строка “что это”.

4.1.3. Связи и кратности
Содержание подпункта: текстом (или таблицей) указать отношения и кратности:

Организатор 1..* Рецепты

Организатор 1..* Мероприятия

Мероприятие 1..* РецептВМероприятии

Рецепт 1..* ИнгредиентыРецепта

Мероприятие 1..* ПунктыСпискаПокупок

СправочникИнгредиентов 0..1 ↔ ИнгредиентРецепта (опциональная ссылка)
и т.п.

4.1.4. Диаграмма модели данных
Содержание подпункта: ссылка на ER/логическую диаграмму (mermaid/plantuml/картинка). Если диаграммы ещё нет — место под неё.

4.1.5. Ключевые ограничения данных
Содержание подпункта: логические ограничения, которые важны для требований и тестирования (без SQL):

уникальность названия рецепта в библиотеке организатора;

уникальность “название+дата” мероприятия среди активных;

запрет дублировать один рецепт в одном мероприятии;

обязательные поля (например название рецепта, минимум 1 ингредиент);

архивированное мероприятие неизменяемо;

правила “куплено/не куплено” для пункта списка покупок.

4.1.6. Идентификаторы и область видимости данных
Содержание подпункта: какие данные изолированы по организатору, как идентифицируются сущности (логически: organizer_id, recipe_id, event_id), что видит участник по ссылке (только данные конкретного мероприятия).


## 4.1 Логическая модель данных

### 4.1.1 Назначение модели данных

Логическая модель данных описывает состав данных, используемых приложением **_К столу!_**, а также связи и ключевые ограничения между этими данными в рамках **_Release 0.1 (MVP)_**. Модель предназначена для согласования общего понимания данных между участниками разработки и служит основой для проектирования базы данных, разработки API и подготовки тестовых сценариев. Логическая модель фиксирует *что* должно храниться и обрабатываться системой, но не определяет физическую реализацию хранения (конкретные типы СУБД, индексы, оптимизации и т.п.).

### 4.1.2 Перечень сущностей

В рамках **_Release 0.1 (MVP)_** используются следующие основные сущности:

- **_Организатор_** — владелец данных (рецептов и мероприятий), создаёт мероприятия и управляет ими.
- **_Рецепт_** — описание блюда, сохранённое в библиотеке рецептов **_Организатора_**.
- **_Ингредиент рецепта_** — элемент состава **_Рецепта_** (наименование, количество, единица измерения и уточнение).
- **_Мероприятие_** — объект планирования готовки, содержащий метаданные и список выбранных рецептов.
- **_Рецепт в мероприятии_** — связь **_Мероприятия_** и **_Рецепта_** с указанием количества порций для данного мероприятия.
- **_Пункт списка покупок_** — строка в **_Списке покупок_** мероприятия (наименование, количество, единица измерения, признак «куплено/не куплено», список примечаний и источник формирования).
- **_Справочник ингредиентов_** — внутренний справочник, используемый для выбора/подсказки ингредиентов при вводе рецепта и для повышения качества агрегации списка покупок.
- **_Ссылка-приглашение_** — идентификатор доступа по ссылке к конкретному **_Мероприятию_** для **_Участников по ссылке_**.

### 4.1.3 Связи и кратности

Основные связи сущностей:

- **_Организатор_** 1 — * **_Рецепт_**  
  Один **_Организатор_** может иметь множество **_Рецептов_**. Каждый **_Рецепт_** принадлежит одному **_Организатору_**.

- **_Рецепт_** 1 — * **_Ингредиент рецепта_**  
  Один **_Рецепт_** содержит один или более **_Ингредиентов рецепта_**. Каждый **_Ингредиент рецепта_** относится к одному **_Рецепту_**.

- **_Организатор_** 1 — * **_Мероприятие_**  
  Один **_Организатор_** может создать множество **_Мероприятий_**. Каждое **_Мероприятие_** принадлежит одному **_Организатору_**.

- **_Мероприятие_** 1 — * **_Рецепт в мероприятии_**  
  Одно **_Мероприятие_** содержит множество записей **_Рецепт в мероприятии_** (по одной на каждый добавленный рецепт). Каждая запись относится к одному **_Мероприятию_**.

- **_Рецепт_** 1 — * **_Рецепт в мероприятии_**  
  Один **_Рецепт_** может быть использован во многих **_Мероприятиях_**. Каждая запись **_Рецепт в мероприятии_** ссылается на один **_Рецепт_**.

- **_Мероприятие_** 1 — * **_Пункт списка покупок_**  
  У одного **_Мероприятия_** есть один **_Список покупок_**, представленный множеством **_Пунктов списка покупок_**. Каждый **_Пункт списка покупок_** относится к одному **_Мероприятию_**.

- **_Справочник ингредиентов_** 0..1 — 0..* **_Ингредиент рецепта_**  
  **_Ингредиент рецепта_** может иметь ссылку на элемент **_Справочника ингредиентов_** (если выбран из справочника). Один элемент справочника может использоваться в множестве ингредиентов разных рецептов.

- **_Мероприятие_** 1 — 1 **_Ссылка-приглашение_**  
  Для каждого **_Мероприятия_** создаётся одна **_Ссылка-приглашение_**. Каждая **_Ссылка-приглашение_** относится к одному **_Мероприятию_**.

### 4.1.4 Диаграмма модели данных

Диаграмма концептуальной модели данных представлена на рисунке [4.1](Приложение%20Б.%20Диаграммы/4.1%20-%20Диаграмма%20концептуальной%20модели%20данных.jpg)
ER-диаграмма логической модели данных представлена на рисунке [4.2](Приложение%20Б.%20Диаграммы/4.2%20-%20Диаграмма%20логической%20модели%20данных.jpg).

### 4.1.5 Ключевые ограничения данных

- Название **_Рецепта_** должно быть уникальным в библиотеке рецептов **_Организатора_**.
- **_Рецепт_** должен содержать название и как минимум один **_Ингредиент рецепта_**.
- Среди активных (не архивированных) **_Мероприятий_** **_Организатора_** не допускается наличие двух **_Мероприятий_** с одинаковым сочетанием «название + дата проведения (без времени)».
- В одном **_Мероприятии_** один и тот же **_Рецепт_** не может присутствовать более одного раза (без дублирования); изменение количества порций выполняется через атрибут порций записи **_Рецепт в мероприятии_**.
- Архивированное **_Мероприятие_** не подлежит изменению (метаданные и состав неизменяемы).
- **_Пункт списка покупок_** содержит признак «куплено/не куплено», который изменяется **_Организатором_** и **_Участником по ссылке_** и сохраняется системой.
- В рамках MVP преобразование единиц измерения при агрегации **_Списка покупок_** не выполняется; ингредиенты с разными единицами измерения отображаются отдельными пунктами.

### 4.1.6 Идентификаторы и область видимости данных

- Все данные (рецепты, мероприятия, список покупок) принадлежат конкретному **_Организатору_** и изолированы от других организаторов.
- **_Участник по ссылке_** не является владельцем данных и получает доступ только к данным конкретного **_Мероприятия_**, на которое указывает **_Ссылка-приглашение_**.
- Система использует внутренние идентификаторы сущностей (например: `organizer_id`, `recipe_id`, `event_id`, `shopping_item_id`) для ссылок между сущностями и обеспечения целостности данных.


4.2. Словарь данных
4.2.1. Правила оформления словаря
Содержание подпункта: формат описания (таблица), что указывается для полей: описание, обязательность, уникальность, допустимые значения/диапазоны, пример. (Типы можно указывать логически: string/int/date/time/enum).

4.2.2. Сущность: Организатор
Содержание подпункта: таблица полей (например organizer_id, created_at, “идентификатор в localStorage” как привязка).

4.2.3. Сущность: Рецепт
Содержание подпункта: поля рецепта (название, обложка, шаги, время, порции по умолчанию, категория, даты создания/изменения).

4.2.4. Сущность: Ингредиент рецепта
Содержание подпункта: поля ингредиента в рецепте (наименование, количество, единица, уточнение; ссылка на справочник при наличии).

4.2.5. Сущность: Мероприятие
Содержание подпункта: метаданные (название, дата, время, статус активное/архив, ссылка-приглашение, даты создания/архивации/удаления).

4.2.6. Сущность: Рецепт в мероприятии
Содержание подпункта: связка event_id + recipe_id и порции в мероприятии; запрет дубля; “сохранённое название рецепта на момент архива” (если храним).

4.2.7. Сущность: Пункт списка покупок
Содержание подпункта: наименование, количество, единица, признак куплено, источник (из рецепта или вручную), группировка/идентификатор ингредиента (если есть).

4.2.8. Сущность: Справочник ингредиентов
Содержание подпункта: поля справочника (ingredient_catalog_id, отображаемое имя, синонимы/нормализация — если планируется, единицы по умолчанию — если есть в MVP).

4.2.9. Сущность: Ссылка-приглашение
Содержание подпункта: если отдельная сущность — поля (token/ключ, event_id, дата создания, признак действительности). Если хранится в мероприятии — указать это.

4.3. Отчёты
4.3.1. Перечень отчётов MVP
Содержание подпункта: что считается отчётом (например: “выгрузка/печать списка покупок” или “не предусмотрено в MVP”).

4.3.2. Формат и содержание
Содержание подпункта: для каждого отчёта — какие поля выводятся, в каком виде (если отчёты есть).

4.4. Получение, ценность, хранение и утилизация данных
4.4.1. Источники данных
Содержание подпункта: пользовательский ввод (рецепты/мероприятия), автоматическая генерация (список покупок), справочник ингредиентов (внутренний/внешний источник).

4.4.2. Правила хранения и обновления
Содержание подпункта: где и как данные сохраняются логически (серверная БД), что обновляет что (изменение рецепта → актуализация списка покупок), автосохранение отметок куплено.

4.4.3. Удаление и восстановление
Содержание подпункта: удаление рецепта/мероприятия без восстановления в MVP; что происходит со ссылкой; поведение при удалённом рецепте в архиве/мероприятии.

4.4.4. Архивирование и жизненный цикл данных
Содержание подпункта: что значит архив, какие данные “замораживаются”, что доступно для просмотра, как работает повтор и разархивация (с точки зрения данных).

4.4.5. Качество данных и риски
Содержание подпункта: риски неполного справочника ингредиентов, разные единицы измерения без конвертации в MVP, возможные дубли/опечатки при ручном вводе; что система делает (например, не конвертирует, хранит отдельно).

4.4. Получение, ценность, хранение и утилизация данных
4.4.1. Источники данных
Содержание подпункта: пользовательский ввод (рецепты/мероприятия), автоматическая генерация (список покупок), справочник ингредиентов (внутренний/внешний источник).

4.4.2. Правила хранения и обновления
Содержание подпункта: где и как данные сохраняются логически (серверная БД), что обновляет что (изменение рецепта → актуализация списка покупок), автосохранение отметок куплено.

4.4.3. Удаление и восстановление
Содержание подпункта: удаление рецепта/мероприятия без восстановления в MVP; что происходит со ссылкой; поведение при удалённом рецепте в архиве/мероприятии.

4.4.4. Архивирование и жизненный цикл данных
Содержание подпункта: что значит архив, какие данные “замораживаются”, что доступно для просмотра, как работает повтор и разархивация (с точки зрения данных).

4.4.5. Качество данных и риски
Содержание подпункта: риски неполного справочника ингредиентов, разные единицы измерения без конвертации в MVP, возможные дубли/опечатки при ручном вводе; что система делает (например, не конвертирует, хранит отдельно).