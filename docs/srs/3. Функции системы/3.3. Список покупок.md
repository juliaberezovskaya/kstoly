## 3.3 Список покупок

### 3.3.1 Описание

Функция **_Список покупок_** обеспечивает формирование и ведение перечня ингредиентов, необходимых для приготовления блюд выбранного **_Мероприятия_**. **_Список покупок_** формируется системой автоматически на основе **_Рецептов_**, добавленных в **_Мероприятие_**, с учётом количества порций, заданного для каждого **_Рецепта_** в рамках **_Мероприятия_**.

**_Организатор_** и **_Участник по ссылке_** могут просматривать **_Список покупок_** и отмечать купленные продукты. **_Организатор_** также может управлять **_Списком покупок_** (добавлять/редактировать/удалять пункты вручную и пересоздавать список из рецептов).

**Связанные артефакты:**  
User Stories: `US-S1` – `US-S5`  
Use Cases: `UC-S1` – `UC-S?`  
Business Rules: `BR-S?`, `BR-R?`, `BR-E?`


### 3.3.2 Функциональные требования


### FR-L1. Доступ и просмотр списка покупок

#### FR-S1.1. Система должна предоставлять **_Организатору_** доступ к **_Списку покупок_** выбранного **_Мероприятия_**.
Приоритет: Высокий  
Источники: [UC-S1](), [US-S1](), [UC-E3]()

#### FR-L1.2. Система должна предоставлять **_Участнику по ссылке_** доступ к **_Списку покупок_** **_Мероприятия_** по **_Ссылке-приглашению_**.
Приоритет: Высокий  
Источники: [UC-S1](), [US-S1](), [UC-E4]()

#### FR-L1.3. Система должна отображать **_Список покупок_** в виде перечня **_Пунктов списка покупок_**.
Приоритет: Высокий  
Источники: [UC-S1](), [US-S1]()

#### FR-L1.4. Для каждого **_Пункта списка покупок_** система должна отображать как минимум: наименование, количество и единицу измерения (если применимо), а также признак «куплено/не куплено».
Приоритет: Высокий  
Источники: [UC-S1](), [BR-S?]()

#### FR-L1.5. Если **_Список покупок_** не может быть загружен, система должна отображать сообщение об ошибке.
Приоритет: Высокий  
Источники: [UC-S1](), [BR-S2]()

#### FR-L1.6. Система должна отображать **_Список покупок_** в детерминированном порядке: сортировать **_Пункты списка покупок_** по наименованию по возрастанию, при совпадении наименования — группировать рядом пункты с разными единицами измерения и сортировать их по единице измерения по возрастанию.
Приоритет: Средний  
Источники: [UC-L1](), [BR-L?]()

### FR-L2. Автоматическое формирование и актуальность списка покупок

#### FR-L2.1. Система должна автоматически формировать **_Список покупок_** **_Мероприятия_** на основе ингредиентов **_Рецептов_**, добавленных в **_Мероприятие_**.
Приоритет: Высокий  
Источники: [UC-S2](), [UC-E5](), [US-S1]()

#### FR-L2.2. При формировании **_Списка покупок_** система должна учитывать количество порций, заданное для каждого **_Рецепта_** в рамках **_Мероприятия_**.
Приоритет: Высокий  
Источники: [UC-S2](), [UC-E5](), [BR-E?]()

#### FR-L2.3. При добавлении **_Рецепта_** в **_Мероприятие_** система должна обеспечивать актуальность **_Списка покупок_** **_Мероприятия_** с учётом добавленного **_Рецепта_**.
Приоритет: Высокий  
Источники: [UC-E5](), [UC-S2](), [US-S1]()

#### FR-L2.4. При удалении **_Рецепта_** из **_Мероприятия_** система должна обеспечивать актуальность **_Списка покупок_** **_Мероприятия_** с учётом удаления **_Рецепта_**.
Приоритет: Высокий  
Источники: [UC-E5](), [UC-S2](), [US-S1]()

#### FR-L2.5. При изменении количества порций **_Рецепта_** в **_Мероприятии_** система должна обеспечивать актуальность **_Списка покупок_** **_Мероприятия_** с учётом изменения порций.
Приоритет: Высокий  
Источники: [UC-E5](), [UC-S2](), [US-S1]()

#### FR-L2.6. При изменении ингредиентов **_Рецепта_**, который используется в **_Мероприятии_**, система должна обеспечивать актуальность **_Списка покупок_** соответствующего **_Мероприятия_**.
Приоритет: Высокий  
Источники: [FR-R4](), [UC-S2](), [US-S1]()

#### FR-L2.7. Если автоматическое формирование или обновление **_Списка покупок_** не может быть выполнено, система должна отображать сообщение об ошибке.
Приоритет: Высокий  
Источники: [UC-S2](), [BR-S2]()

### FR-L3. Агрегация пунктов списка покупок (MVP)

#### FR-L3.1. При формировании **_Списка покупок_** система должна агрегировать ингредиенты, относящиеся к одному наименованию и одной единице измерения, суммируя их количества.
Приоритет: Высокий  
Источники: [UC-S2](), [BR-S?]()

#### FR-L3.2. Если ингредиенты имеют разные единицы измерения, система не должна выполнять преобразование единиц измерения в рамках MVP и должна отображать их как отдельные **_Пункты списка покупок_**, расположенные рядом.
Приоритет: Средний  
Источники: [UC-S2](), [BR-S?]()

#### FR-L3.3. Система должна обеспечивать предсказуемость агрегации за счёт использования единых правил сравнения наименований ингредиентов (например, по идентификатору ингредиента из справочника при наличии; иначе — по введённому пользователем наименованию).
Приоритет: Средний  
Источники: [UC-S2](), [BR-S?]()

#### FR-L3.4. Система должна отображать в **_Пункте списка покупок_** примечания к ингредиентам, указанные в исходных **_Рецептах_**, из которых сформирован данный пункт.
Приоритет: Высокий  
Источники: [US-L3](), [UC-L1]()

#### FR-L3.5. Для каждого **_Пункта списка покупок_**, сформированного автоматически, система должна отображать источник формирования: список **_Рецептов_** (с возможностью открыть соответствующий **_Рецепт_**) и соответствующие им примечания к ингредиентам.
Приоритет: Высокий  
Источники: [US-L3](), [UC-L1](), [UC-E3]()

#### FR-L3.6. При агрегации ингредиентов в один **_Пункт списка покупок_** система должна агрегировать источники и примечания, сохраняя возможность определить, из какого **_Рецепта_** и из какого ингредиента получено каждое примечание.
Приоритет: Средний  
Источники: [US-L3](), [UC-L1]()


### FR-L4. Отметка купленных продуктов

#### FR-L4.1. Система должна предоставлять **_Организатору_** возможность отмечать **_Пункты списка покупок_** как «куплено/не куплено».
Приоритет: Высокий  
Источники: [UC-S3](), [US-S2]()

#### FR-L4.2. Система должна предоставлять **_Участнику по ссылке_** возможность отмечать **_Пункты списка покупок_** как «куплено/не куплено».
Приоритет: Высокий  
Источники: [UC-S3](), [US-S2]()

#### FR-L4.3. Система должна сохранять признак «куплено/не куплено» для каждого **_Пункта списка покупок_**.
Приоритет: Высокий  
Источники: [UC-S3](), [BR-S?]()

#### FR-L4.4. Если изменение признака «куплено/не куплено» не может быть сохранено, система должна отображать сообщение об ошибке.
Приоритет: Высокий  
Источники: [UC-S3](), [BR-S2]()

> Примечание: требования синхронизации отметок между пользователями описываются в разделе 3.4.


### FR-L5. Ручное управление списком покупок (Организатор)

#### FR-L5.1. Система должна предоставлять **_Организатору_** возможность добавить **_Пункт списка покупок_** вручную.
Приоритет: Высокий  
Источники: [UC-S4](), [US-S4]()

#### FR-L5.2. При ручном добавлении **_Пункта списка покупок_** система должна обеспечивать ввод наименования, количества и единицы измерения (если применимо).
Приоритет: Высокий  
Источники: [UC-S4](), [BR-S?]()

#### FR-L5.3. Система должна предоставлять **_Организатору_** возможность изменить вручную добавленный **_Пункт списка покупок_** (наименование/количество/единицу измерения).
Приоритет: Средний  
Источники: [UC-S4](), [US-S4]()

#### FR-L5.4. Система должна предоставлять **_Организатору_** возможность удалить **_Пункт списка покупок_**.
Приоритет: Средний  
Источники: [UC-S4](), [US-S4]()

#### FR-L5.5. Система должна предоставлять **_Организатору_** возможность пересоздать **_Список покупок_** на основе **_Рецептов_** **_Мероприятия_**.
Приоритет: Средний  
Источники: [UC-S5](), [US-S5]()

#### FR-L5.6. При пересоздании **_Списка покупок_** система должна удалять изменения **_Списка покупок_**, внесённые вручную (**_Организатором_**), и формировать список заново на основе **_Рецептов_** **_Мероприятия_**.
Приоритет: Средний  
Источники: [UC-S5](), [US-S5]()

#### FR-L5.7. Перед пересозданием **_Списка покупок_** система должна запрашивать подтверждение у **_Организатора_**.
Приоритет: Средний  
Источники: [UC-S5]()
