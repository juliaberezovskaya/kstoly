## 3.3 Список покупок

### 3.3.1 Описание

Функция **_Список покупок_** обеспечивает формирование и ведение перечня ингредиентов, необходимых для приготовления блюд выбранного **_Мероприятия_**. **_Список покупок_** формируется системой автоматически на основе **_Рецептов_**, добавленных в **_Мероприятие_**, с учётом количества порций, заданного для каждого **_Рецепта_** в рамках **_Мероприятия_**.

**_Организатор_** и **_Участник по ссылке_** могут просматривать **_Список покупок_** и отмечать купленные продукты. **_Организатор_** также может управлять **_Списком покупок_** (добавлять/редактировать/удалять пункты вручную и пересоздавать список из рецептов).

**Связанные артефакты:**  
User Stories: `US-S1` – `US-S5`  
Use Cases: `UC-S1` – `UC-S?`  
Business Rules: `BR-S?`, `BR-R?`, `BR-E?`


### 3.3.2 Функциональные требования


### FR-L1. Доступ и просмотр списка покупок

#### FR-L1.1.
Система должна предоставлять **_Организатору_** доступ к **_Списку покупок_** выбранного **_Мероприятия_**.  
Приоритет: Высокий  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-C2](../../business-rules.md#br-c2-права-организатора), [US-L1](../../user-stories.md#us-l1-как-участник-приготовления-я-хочу-просматривать-список-покупок-чтобы-ознакомиться-с-тем-что-необходимо-купить)

#### FR-L1.2.
Система должна предоставлять **_Участнику по ссылке_** доступ к **_Списку покупок_** **_Мероприятия_** по **_Ссылке-приглашению_**.  
Приоритет: Высокий  
Источники: [UC-C2](../../use-cases/UC-C2.%20Получить%20доступ%20к%20мероприятию%20по%20ссылке.md), [BR-C3](../../business-rules.md#br-c3-права-участника-по-ссылке), [US-L1](../../user-stories.md#us-l1-как-участник-приготовления-я-хочу-просматривать-список-покупок-чтобы-ознакомиться-с-тем-что-необходимо-купить)

#### FR-L1.3.
Система должна отображать **_Список покупок_** в виде перечня **_Пунктов списка покупок_**.  
Приоритет: Высокий  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L1.4.
Для каждого **_Пункта списка покупок_** система должна отображать как минимум: наименование, количество и единицу измерения (если применимо), а также признак «куплено/не куплено».  
Приоритет: Высокий  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L1.5.
Если **_Список покупок_** не может быть загружен, система должна отображать сообщение об ошибке.  
Приоритет: Высокий  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-S2](../../business-rules.md#br-s-общие-правила-обработки-ошибок)

#### FR-L1.6.
Система должна отображать **_Список покупок_** в детерминированном порядке: сортировать **_Пункты списка покупок_** по наименованию по возрастанию, при совпадении наименования — группировать рядом пункты с разными единицами измерения и сортировать их по единице измерения по возрастанию.  
Приоритет: Средний  
Источники: - 

### FR-L2. Автоматическое формирование и актуальность списка покупок

#### FR-L2.1.
Система должна автоматически формировать **_Список покупок_** **_Мероприятия_** на основе ингредиентов **_Рецептов_**, добавленных в **_Мероприятие_**.  
Приоритет: Высокий  
Источники: [UC-E2](../../use-cases/UC-E2.%20Редактировать%20мероприятие.md), , [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist), [US-E4](../../user-stories.md#us-e4-как-организатор-я-хочу-чтобы-при-добавлении-рецепта-в-меню-ингредиенты-автоматически-добавлялись-в-список-покупок-и-удалялись-соответственно-чтобы-не-пришлось-тратить-время-на-ручное-оформление-списка-и-уменьшилось-количество-потенциальных-ошибок)

#### FR-L2.2.
При формировании **_Списка покупок_** система должна учитывать количество порций, заданное для каждого **_Рецепта_** в рамках **_Мероприятия_**.  
Приоритет: Высокий  
Источники: [BR-L2](../../business-rules.md#br-l2-масштабирование-порций-рецептов-в-мероприятии-br-shoppinglistscaling)

#### FR-L2.3.
При добавлении **_Рецепта_** в **_Мероприятие_** система должна обеспечивать актуальность **_Списка покупок_** **_Мероприятия_** с учётом добавленного **_Рецепта_**.  
Приоритет: Высокий  
Источники: [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L2.4.
При удалении **_Рецепта_** из **_Мероприятия_** система должна обеспечивать актуальность **_Списка покупок_** **_Мероприятия_** с учётом удаления **_Рецепта_**.  
Приоритет: Высокий  
Источники: [UC-E2](../../use-cases/UC-E2.%20Редактировать%20мероприятие.md), [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L2.5.
При изменении количества порций **_Рецепта_** в **_Мероприятии_** система должна обеспечивать актуальность **_Списка покупок_** **_Мероприятия_** с учётом изменения порций.  
Приоритет: Высокий  
Источники: [BR-L2](../../business-rules.md#br-l2-масштабирование-порций-рецептов-в-мероприятии-br-shoppinglistscaling)

#### FR-L2.6.
При изменении ингредиентов **_Рецепта_**, который используется в **_Мероприятии_**, система должна обеспечивать актуальность **_Списка покупок_** соответствующего **_Мероприятия_**.  
Приоритет: Высокий  
Источники: - 

#### FR-L2.7.
Если автоматическое формирование или обновление **_Списка покупок_** не может быть выполнено, система должна отображать сообщение об ошибке.  
Приоритет: Высокий  
Источники: [UC-E2](../../use-cases/UC-E2.%20Редактировать%20мероприятие.md), [BR-S2](../../business-rules.md#br-s-общие-правила-обработки-ошибок)

### FR-L3. Агрегация пунктов списка покупок (MVP)

#### FR-L3.1.
При формировании **_Списка покупок_** система должна агрегировать ингредиенты, относящиеся к одному наименованию и одной единице измерения, суммируя их количества.  
Приоритет: Высокий  
Источники: [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L3.2.
Если ингредиенты имеют разные единицы измерения, система не должна выполнять преобразование единиц измерения в рамках MVP и должна отображать их как отдельные **_Пункты списка покупок_**, расположенные рядом.  
Приоритет: Средний  
Источники: 

#### FR-L3.3.
Система должна обеспечивать предсказуемость агрегации за счёт использования единых правил сравнения наименований ингредиентов (например, по идентификатору ингредиента из справочника при наличии; иначе — по введённому пользователем наименованию).  
Приоритет: Средний  
Источники: [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L3.4.
Система должна отображать в **_Пункте списка покупок_** примечания к ингредиентам, указанные в исходных **_Рецептах_**, из которых сформирован данный пункт.  
Приоритет: Высокий  
Источники: [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L3.5.
Для каждого **_Пункта списка покупок_**, сформированного автоматически, система должна отображать источник формирования: список **_Рецептов_** (с возможностью открыть соответствующий **_Рецепт_**) и соответствующие им примечания к ингредиентам.  
Приоритет: Высокий  
Источники: [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist), [US-L3](../../user-stories.md#us-l3-как-участник-приготовления-я-хочу-видеть-из-каких-рецептов-и-ингредиентов-сформирован-каждый-пункт-в-списке-покупок-чтобы-понимать-откуда-он-взялся)

#### FR-L3.6.
При агрегации ингредиентов в один **_Пункт списка покупок_** система должна агрегировать источники и примечания, сохраняя возможность определить, из какого **_Рецепта_** и из какого ингредиента получено каждое примечание.  
Приоритет: Средний  
Источники: [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)


### FR-L4. Отметка купленных продуктов

#### FR-L4.1.
Система должна предоставлять **_Организатору_** возможность отмечать **_Пункты списка покупок_** как «куплено/не куплено».  
Приоритет: Высокий  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-C2](../../business-rules.md#br-c2-права-организатора), [US-L2](../../user-stories.md#us-l2-как-участник-приготовления-я-хочу-отмечать-купленные-продукты-в-списке-покупок-чтобы-отделять-купленное-от-некупленного)

#### FR-L4.2.
Система должна предоставлять **_Участнику по ссылке_** возможность отмечать **_Пункты списка покупок_** как «куплено/не куплено».  
Приоритет: Высокий  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-C3](../../business-rules.md#br-c3-права-участника-по-ссылке)

#### FR-L4.3.
Система должна сохранять признак «куплено/не куплено» для каждого **_Пункта списка покупок_**.  
Приоритет: Высокий  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md)

#### FR-L4.4.
Если изменение признака «куплено/не куплено» не может быть сохранено, система должна отображать сообщение об ошибке.  
Приоритет: Высокий  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md)

> Примечание: требования синхронизации отметок между пользователями описываются в разделе 3.4.


### FR-L5. Ручное управление списком покупок (Организатор)

#### FR-L5.1.
Система должна предоставлять **_Организатору_** возможность добавить **_Пункт списка покупок_** вручную.  
Приоритет: Высокий  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist), [US-L4](../../user-stories.md#us-l4-как-организатор-я-хочу-добавлять-и-удалять-пункты-в-списке-покупок-чтобы-учитывать-дополнительные-продукты-которые-не-входят-ни-в-один-рецепт)

#### FR-L5.2.
При ручном добавлении **_Пункта списка покупок_** система должна обеспечивать ввод наименования, количества и единицы измерения (если применимо).  
Приоритет: Высокий  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L5.3.
Система должна предоставлять **_Организатору_** возможность изменить вручную добавленный **_Пункт списка покупок_** (наименование/количество/единицу измерения).  
Приоритет: Средний  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L5.4.
Система должна предоставлять **_Организатору_** возможность удалить **_Пункт списка покупок_**.  
Приоритет: Средний  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L5.5.
Система должна предоставлять **_Организатору_** возможность пересоздать **_Список покупок_** на основе **_Рецептов_** **_Мероприятия_**.  
Приоритет: Средний  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist), [US-L5](../../user-stories.md#us-l5-как-организатор-я-хочу-иметь-возможность-пересоздать-список-покупок-на-основе-текущих-рецептов-чтобы-сбросить-накопившиеся-ручные-правки-и-вернуться-к-базовой-версии-списка)

#### FR-L5.6.
При пересоздании **_Списка покупок_** система должна удалять изменения **_Списка покупок_**, внесённые вручную (**_Организатором_**), и формировать список заново на основе **_Рецептов_** **_Мероприятия_**.  
Приоритет: Средний  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md), [BR-L1](../../business-rules.md#br-l1-формирование-и-обновление-списка-покупок-мероприятия-br-shoppinglistlist)

#### FR-L5.7.
Перед пересозданием **_Списка покупок_** система должна запрашивать подтверждение у **_Организатора_**.  
Приоритет: Средний  
Источники: [UC-L1](../../use-cases/UC-L1.%20Работать%20со%20списком%20покупок%20мероприятия.md)
